<html>
<head>
    <style></style>
    <title>クラウドGPUの比較について</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
</head>

<body>
    <p>
        ステアラボでは、私たちはクラウドでGPUがついてるマシンを使うことがあります。複数のクラウドプロバイダーからの数多くのオファーの性能とコストを比較するため、私たちは各クラウドプロバイダーのウエブサイトから集めた情報を表にまとめ、いくつかインタラクティブグラフを作ってみました。<a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">こちら</a>は各オファーの主なスペックと値段の表の他に、CPUとGPUの性能を比較するグラフ、使う時間によって変動するコストのグラフ、一定の利用期間あたりのコストの比較、CPUとGPUの1TFlopsあたりのコストを比較するグラフがあります。<a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">こちら</a>は計算量を固定して、GPUで計算する時間とそれにかかるコストのグラフとCPU計算時間とコストでオファーを比較するための2つのグラフがあります。
    </p>
    <p>
        クラウドGPUのオファーは今はたくさんありますが、振り替えてみれば一年前はまだ珍しかったクラウドGPUは主に可視化向けのものでした。2016年の9月から機械学習用のクラウドGPUのp2インスタンス<a href="#note1"><sup>1</sup></a>を提供し始めたAmazonに続いて、Softlayer (IBM)、 Nimbix、 MS Azure、 Google Compute Cloudなど、たくさんのプロバイダーから続々とたくさんのオファーが出ました。機械学習に主な用途が変わったため、GPUとCPUの性能も上がり、メモリーも増えまして：1000GBまでのインスタンスがあります。HDDはSSDが主流になりました。
    </p>
        
    <p>
        マイクロソフトAzure初のGPUインスタンス、Nシリーズは去年の8月に発表されたものの、すべてのユーザに公開されたのは12月でした。AzureクラウドのNシリーズは他のプロバイダーのオファーの中で性能的にもコスト的にも目立ちませんが、マイクロソフトが開発した機械学習フレームワークAzure Machine Learning Studioを使用できるというメリットがあります。
        アメリカの大手クラウドプロバイダーの中で最後にGPUインスタンスの提供を始めたGoogleですが、インスタンスのスペックを細かく設定できるのは大きな特徴です。GPUの種類では、NVIDIA M60を載せたマイクロソフトのNVシリーズ以外は、すべてNVIDIA K80<a href="#note2"><sup>2</sup></a>を提供しています。
    </p>
     
    <p>
        同じ2016年にさくらインターネットという日本のプロバイダーがGPUサーバーの提供を始めました。同レベルの性能のオファーと比較したら、月額は安いです。特にNVIDIA Titan Xを4枚載せたQuad GPU modelサーバーがコストパフォーマンスで魅力的です。ただ、初期費用があるため短期間で利用する場合は他社のオファーが有利になります。
    <p>
        あまり有名ではLeaderTelecomというドイツのプロバイダーですが、GPU的に高性能のインスタンスを割安で提供しています。CPUの性能も高そうだが、メモリー量は128GBまでで低めのスペックです。ちなみに、そのLeaderTelecomはオファーの数でトップでしたが数日前からウェブサイトでオファーの数が劇的に減り、今は3種類のインスタンスだけを提供して入るようです。IBMのクラウドプロバイダーSoftlayerは、P40が8個とQuadro P6000が8個の、GPU性能で最も高いインスタンスを提供しています。
    </p>
    <p>
        一般的なクラウドプロバイダーではないのですが、東京大学はGPUが乗っているスパーコンピュータReedbush-Hを、教育機関はもちろんのこと、一般企業にも審査が通った用途に提供しています。GPUの性能では目立たないスペックなのですが、CPU性能やインターコネクト幅などで最高標準です。値段も割安なので、審査さえクリアできれば、最高のコストパフォマンスのクラウドGPUを利用できます。ただ、一つ注意すべきところがあり、スーパーコンピューターは全てのノードのソフトウェア環境が同じであり、root権限も与えられないので、管理者がインストールした以外のソフトウェアは、インストールできないかもしれません。もう一つの注意点としては、1年間のプランなのですが、使用できるノード時間が限られています。ずっと計算しっぱなしにすると1年間足らずでノード時間がなくなってしまい、計算するには追加料金かかってしまいます。<a href="http://www.cc.u-tokyo.ac.jp/support/application/kitei/hyou5.pdf" target="_blank">東京大学のウエブサイト</a>の備考をよく読んでください。
    </p>

    

    <p>
        それぞれのインスタンスを比較するのは難しいです。GPUとCPUのモデル、メモリーとハードディスクの量、インターコネクトとインターネットの幅などのスペックが違います。コストももちろん変わりますし、課金期間も違います：分ごとに課金されるプランもあれば、年ごとに課金されるプランもあります。設定金があるプランもあり、使用できるノード時間が制限されるプランもあります。
    </p>
    
 
    <p>
        性能を比較するために、性能に大きな影響のあるパラメータであるGPU性能とCPU性能を使ってみましょう。<a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">こちら</a>にはGPUとCPU性能のグラフや他の参考にしたいグラフがあります。複数のプロバイダーの沢山のオファーがあるけど、さくらとアマゾンを比較したいので、まずはページの上部にある小さめのフィルタリング用のグラフを使って、全てのグラフで表示されるオファーをプロバイダーで制限（フィルタリング）してましょう。
    </p>
    <figure>
        <img src="filtergraphs.png" />
        <figcaption>プロバイダーでオファーを制限した状態のフィルタリンググラフ。一つのグラフをクリックして制限をかけると、他のグラフで制限されたオファーだけの情報が写ります。</figcaption>
    </figure>
    
    <figure>
        <img src="cpu_gpu_performance.png" />
        <figcaption>GPUとCPUの性能グラフ。CPUとGPUの性能で近いAmazonのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーのコストを比較してみましょう。</figcaption>
    </figure>
    
    
    <figure>
        <img src="time_cost.png" />
        <figcaption>利用期間によって変動するコストのグラフ。Amazonのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーのコストの比較。2ヶ月以上使うならさくらインターネットのオファーの方が安くなります。</figcaption>
    </figure>
    
    <p>
        Amazonのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーはCPUとGPUの性能で近いのですが、どちらが安いでしょうか？さくらインターネットのオファーは月ごとに課金され、初期費用もかかります。一方、Amazonのオファーは時間単位で課金され、初期費用もありません。上のコストグラフを見ますと、2ヶ月以上を使うならさくらインターネットのオファーの方が安くなることがわかります。
    </p>
    <p>
        上記のような性能で近いオファーの場合は、コストを比較すればどちらが有利かわかるのですが、性能的に遠いオファーの場合は性能単位であるFlopsのコストで比較することができます。利用期間によってコストが変われば、1Tflopsあたりのコストも変動しますので、利用期間を変更すれば1TFlopsあたりのコストのグラフも変わります。
    </p>
    
        
    <figure>
    <img src="1tflops_cost.png" />
        <figcaption>1TFlopsあたりのコストでAmazonとさくらインターネットのオファーを比較。</figcaption>
    </figure>
    <p>
        Amazonとさくらインターネットのオファーを比較してみると、2ヶ月の利用期間でGPUの1TFlopsあたりのコストでさくらTitanX x4インスタンスが一番安く、CPUの1TFlopsあたりのコストでAmazonの1年間契約のp2インスタンスが一番安いことがわかります。利用期間を長くしたら、TitanX x4がCPU性能のコストでも一番安くなってきますし、GPUの性能ではAmazonのオファーよりは数倍やすくなります。
    </p>    
    
    <p>
        利用期間が変われば、コストも1TFlopsあたりのコストも変わります。もし使用したい期間は決まっていれば1TFlopsあたりのコストで比較せればいいのですが、もし計算したいタスクが決まっている場合はどうすればいいでしょうか。計算量が決まっていれば、計算にかかる時間とコストでオファーを比較することができます。性能の高いインスタンスほど計算時間が短くなり、その分コストも安くなりますので、多少コストが高くても性能の高いインスタンスが有利なはずです。<a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">こちら</a>にあるがラフでおなじみのAmazonとさくらインターネットのオファーを比較して見ましょう。
    </p>
    
    <figure>
    <img src="GPU_cost_time.png" />
        <figcaption>特定の計算量にかかる費用と時間のグラフ。左下に行くほど有利になります。200EFlopsあたりでさくらインターネットとAmazonのオファーが接戦しています。計算量を増えれば増えるほどさくらインターネットのオファーが有利になります。</figcaption>
    </figure>
    
    
    <p>
        ここで注意しておきたいのですが、CPUとGPU性能以外にも計算時間を左右する要素がたくさんあるので、TFlopsは一つの目安として参考に使ってください。
    </p>
    
    
    <note>
        <sup id="note1">1</sup> インスタンスはクラウドコンピューティングで仮想マシーンに割り当てられるハードウェアのスペックのことを言います。
    </note>

    <note>
        <sup id="note2">2</sup> Amazon、MicrosoftとGoogleがNVIDIA K80のインスタンスを提供していますが、プロバイダーのウエブサイトなどで表示されているGPUの数に注意する必要があります。1枚のK80のカードには2個のTesla GK210 GPUが乗っており、プロバイダーが表示している数はGK210の数で、カードの枚数はその半分です。
    </note>


</body>
</html>