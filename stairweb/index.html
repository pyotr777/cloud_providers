<html>
<head>
    <style></style>
    <title>クラウドGPUの比較について</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <style type="text/css">
		body {
            font-family: "PingFang SC";
			letter-spacing:0.1em;
			line-height:170%;
		}
	</style>
</head>

<body>
<style type="text/css">
  figcaption {
    font-size:90%;
    line-height:150%;
    font-weight: bold;
    margin:0 100px 30px 50px;
  }

</style>
<p>
    私たちステアラボの研究員は、クラウド上のGPUマシンを使って計算を行うことがあります。現在、複数のクラウドプロバイダーから数多くのオファーが提供されており、どのプロバイダーのどういうマシンを利用するか、は難しい選択です。提供されているオファーの性能とコスト（USD）を比較するため、私たちは各クラウドプロバイダーのウェブサイトから集めた情報を表にまとめ、いくつかインタラクティブなグラフを作ってみます。</p>

    <div style="text-align:center;"><a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">CLOUD GPU PROVIDERS COMPARISON</a></div>
    <div style="text-align:center;margin:10px;"><a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">CLOUD GPU PROVIDERS COMPARISON – MORE GRAPHS</a></div><br>

    <p>
        <b>前者</b>には、各オファーの主なスペックと料金の表の他に、CPUとGPUの性能を比較するグラフ、使う時間によって変動するコストのグラフ、一定の利用期間においてのコストのグラフ、CPUとGPUの1TFlops<a href="#note1"><sup>1</sup></a>あたりのコストを比較するグラフがあります。<b>後者</b>は計算量を固定した場合、GPUで計算する時間とそれにかかるコストのグラフとCPU計算時間とコストを比較する2つのグラフです。<br>
        また、両方のページの上部にオファーのグループを選択（フィルタリング）するための<a href="#pic1" title="Fig.1を参照">小さめのグラフ</a>もいくつか併記しました。そのグラフを見れば、プロバイダーごとのオファーの数、GPU数でオファーの分布、メモリー量でオファーの分布など、統計的な情報がわかります。
    </p>
    <p>
        機械学習などの計算をクラウドGPUでしようと思ったら、今はたくさんの選択肢がありますが、振り返ってみればわずか一年前は全く違う状況でした。当時まだ珍しかったクラウドGPUは主に可視化のためのものでした。2016年の9月から機械学習用のクラウドGPUのp2インスタンス<a href="#note2"><sup>2</sup></a>を提供し始めたAmazonに続いて、Softlayer (IBM)、 Nimbix、 MS Azure、 Googleなど、たくさんのプロバイダーから様々なオファーが続々と登場しました。クラウドGPUオファーの主な用途が機械学習の計算に変わったため、GPUとCPUの性能が上がり、メモリーも増え（1000GBまでのインスタンスがあります）ストレージはSSDが主流になりました。
    </p>

    <p>
        マイクロソフトAzureクラウド初のGPUインスタンスであるNシリーズは2016年の8月に発表されたものの、すべてのユーザに公開されたのは12月でした。AzureクラウドのNシリーズは他のプロバイダーのオファーと比較して性能的にもコスト的にも目立ちませんが、マイクロソフトが開発した機械学習フレームワークAzure Machine Learning Studioを使用できるというメリットがあります。
        アメリカの大手クラウドプロバイダーの中で最も遅くGPUインスタンスの提供を始めたGoogleですが、インスタンスのスペックを細かく設定できるのは大きな特徴です。GPUの種類でみると、マイクロソフトのNVシリーズはNVIDIA M60を、アマゾン、マイクロソフト、グーグルはNVIDIA K80<a href="#note3"><sup>3</sup></a>を提供しています。
    </p>

    <p>
        同じく2016年に、日本のプロバイダーであるさくらインターネットがGPUサーバーの提供を始めました。他のプロバイダーが提供している同性能のオファーと比べ、月額料金はとても安くなっています。特にNVIDIA Titan Xを4枚載せたQuad GPU modelサーバーがコストパフォーマンスの点で魅力的です。ただし、初期費用が必要なため短期間で利用する場合は他社のオファーが有利になります。
    </p>
    <p>
        さくらインターネットと同じく、コストパフォーマンスの良いオファーを提供しているプロバイダーにオランダのLeaderTelecomがあります。GPUの性能がとても高いNVIDIA GeForce GTX 1080を8枚載せたインスタンスも提供しています。CPUの性能も高いのですが、メモリー量は128GBまでという低めのスペックです。GPU性能で高水準のLeaderTelecomより、さらに高性能なインスタンスを提供しているプロバイダーが、Cirrascaleです。Cirrascaleは、NVIDIA P40が8枚を載せたインスタンスとQuadro P6000が8枚のインスタンス、GPU性能で最も高いインスタンスを提供しています。
    </p>
    <p>
        一般的なクラウドプロバイダーではないのですが、東京大学がGPU搭載スーパーコンピュータReedbush-Hを、教育機関はもちろんのこと、一般企業にも審査が通った用途に提供しています。GPUの性能では目立たないスペックなのですが、CPU性能やインターコネクト帯域幅などが最高標準です。値段も割安なので、審査さえクリアできれば、最高のコストパフォーマンスのクラウドGPUを利用できます。ただし、注意すべき点として、スーパーコンピューターは全てのノードのソフトウェア環境が同じであり、root権限も与えられないので、新しいソフトウェアをインストールできない可能性が高いです。もう一つの注意点としては、1年間のプランなのですが、使用できるノード時間が限られています。複数のノードにまたがるジョブを長時間で走らせていれば数ヶ月でノード時間を使い切ってしまい、計算するには追加料金がかかってしまうことがあります。詳しくは、<a href="http://www.cc.u-tokyo.ac.jp/support/application/kitei/hyou5.pdf" target="_blank">東京大学のウエブサイト</a>の備考を読んでください。
    </p>


    <p>
        では、私たちが作ったグラフを使っていくつかのオファーを比較してみましょう。
        それぞれのオファーを比較するためには、たくさんの要素を考慮する必要があります。例えば、GPUとCPUのモデル、メモリーとハードディスクの量、インターコネクトとインターネットの帯域幅などです。また、料金も重要な要素の一つです。ただし、プロバイダーごとに課金の時間単位が異なり、単純な比較は難しいです。分ごとに課金されるプランもあれば、年ごとに課金されるプランもあります。さらに初期費用が必要なプランもあり、使用できるノード時間が制限されるプランもあります。
    </p>

    <p>
        インスタンスの性能を比較するために、先ずは性能に大きな影響を与えるGPU性能とCPU性能を比べてみましょう。<a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">Cloud GPU providers comparison</a>ページにはGPUとCPU性能を比較したグラフがあります。例えば、さくらインターネットとアマゾンの比較結果だけを見たい場合は、ページの上部にある小さめのフィルタリング用のグラフを使って、全てのグラフ上に表示されるオファーを制限（フィルタリング）してましょう。フィルタリングは、グラフ右側にあるProviderの下の「Amazon」と「Sakura」をクリックすることで完了します。フィルタリングが完了すると下図（Fig.1）が表示されます。
    </p>

    <figure id="pic1">

        <img src="https://stair.center/wp-content/uploads/2017/04/filtergraphs.png" alt="" width="682" height="310" class="aligncenter size-full wp-image-462"/>

        <figcaption>Fig.1. プロバイダー（AmazonとSakura）でオファーを制限した状態のフィルタリンググラフ。一つのグラフをクリックして制限をかけると、他のグラフで制限されたオファーだけの情報が表示されます。</figcaption>
    </figure>

    <p>
        オファーをアマゾンとさくらインターネットに制限したら、CPUとGPU性能グラフでオファーを比較しましょう。
    </p>
    <figure id="pic2">
        <img src="https://stair.center/wp-content/uploads/2017/04/cpu_gpu_performance.png" alt="" width="682" height="332" class="alignnone size-full wp-image-461"/>

        <figcaption>Fig.2. GPUとCPU性能グラフ。CPUとGPUの性能で近いAmazonとのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーを比較してみましょう。</figcaption>
    </figure>

    <p>
        アマゾンのp2.8xlargeオファーとさくらインターネットの月額課金のQuad GPU modelオファーはCPUとGPUの性能で近いのですが、どちらが安いでしょうか？さくらインターネットのオファーは月ごとに課金され、初期費用もかかります。一方、アマゾンのオファーは時間単位で課金され、初期費用もありません。下のコストグラフを見ますと、2ヶ月以上を使うならさくらインターネットのオファー<a href="#note4"><sup>4</sup></a>の方が安くなることがわかります。
    </p>

    <figure id="pic3">
        <img src="https://stair.center/wp-content/uploads/2017/04/time_cost-1.png" alt="" width="682" height="408" class="alignnone size-full wp-image-588" />

        <figcaption>Fig.3. 利用期間によって変動するコストのグラフ。Amazonのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーのコストの比較。2ヶ月以上使うならさくらインターネットのオファーの方が安くなります。</figcaption>
    </figure>


    <p>
        上記のように性能で近いオファーの場合は、コストを比較さえすればどちらが有利かがわかります。性能的に遠いオファーの場合は性能単位であるFlopsあたりのコストで比較することができます。利用期間によってコストが変われば、Flopsあたりのコストも変動しますので、利用期間を変更すれば1TFlopsあたりのコストのグラフも変わります。コストグラフ（Fig.3）をクリックすることで、利用期間を変更できます。
    </p>


    <figure id="pic4">
        <img src="https://stair.center/wp-content/uploads/2017/04/1tflops_cost.png" alt="" width="683" height="377" class="alignnone size-full wp-image-460" />

        <figcaption>Fig.4. 1TFlopsあたりのコストでAmazonとさくらインターネットのオファーの比較。</figcaption>
    </figure>
    <p>
        アマゾンとさくらインターネットのオファーを比較してみると、2ヶ月の利用期間でGPUの1TFlopsあたりのコストでさくらTitanX x4インスタンスが一番安く、CPUの1TFlopsあたりのコストでアマゾンの1年間契約のp2インスタンスが一番安いことがわかります。利用期間を長くしたら、TitanX x4の方がCPU性能のコストでも一番安くなってきますし、GPUの性能ではアマゾンのオファーよりは数倍やすくなります。
    </p>

    <p>
        利用したい期間は決まっていれば1TFlopsあたりのコストで比較すればいいのですが、もし利用したい期間ではなく、計算したいタスクが決まっている場合はどうすればいいでしょうか。計算が早く終われば、長くクラウドインスタンスを使う必要はありません。計算量が決まっていれば、計算にかかる時間とコストでオファーを比較することができます。性能の高いインスタンスほど計算時間が短くなり、その分コストも安くなりますので、多少コストが高くても性能の高いインスタンスが有利なはずです。<a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">こちら</a>にあるグラフを使っておなじみのアマゾンとさくらインターネットのオファーを比較して見ましょう。
    </p>

    <figure id="pic5">
        <img src="https://stair.center/wp-content/uploads/2017/04/GPU_cost_time.png" alt="" width="682" height="465" class="alignnone size-full wp-image-463" />

        <figcaption>Fig.5. 特定の計算量にかかる費用と時間のグラフ。左下に行くほど有利になります。</figcaption>
    </figure>


    <p>計算量を変えたりして計算にかかるコストと時間でオファーを比較しましょう。計算量が200EFlopsまで上がるあたりでさくらインターネットとAmazonのオファーが接戦しています。計算量がさらに増えれば増えるほどさくらインターネットのオファーが有利になります。CPUの場合は早くも50EFlopsあたりでさくらはアマゾンを追い越します。 計算量の大きいタスクほど、さくらインターネットが有利なることがわかります。</p>
    <p>最後に注意しておきたいのですが、CPUとGPU性能以外にも計算時間を左右する要素がたくさんあるので、今まで比較に使っていたFlopsは一つの目安にすぎないことを忘れずに上記のグラフを使ってください。 </p>
    <p>&nbsp;</p>



    <hr style="height:1px">

    <p class="note" style="font-size:90%; color:#444;">
        <sup id="note1">1</sup> 1秒あたりの浮動小数点演算（Flops）です。 浮動小数点演算の数の単位であるFLOPと混同しないように気をつけてください。CPU性能及びGPU性能は全て単精度の数値です。
    </p>


    <p class="note" style="font-size:90%; color:#444;">
        <sup id="note2">2</sup> クラウドコンピューティングでは貸出する仮想マシンのことをインスタンスといいます。このブログ記事では、仮想マシンとベアメタルサーバを比較することがあり、その時は、便宜上ベアメタルサーバのこともインスタンスと呼んだりしています。
    </p>

    <p class="note" style="font-size:90%; color:#444;">
        <sup id="note3">3</sup> Amazon、MicrosoftとGoogleがNVIDIA K80のインスタンスを提供していますが、プロバイダーのウェブサイトなどで表示されているGPUの数に注意する必要があります。1枚のK80のカードには2個のTesla GK210 GPUが載っており、プロバイダーが表示している数はGK210の数で、カードの枚数はその半分です。
    </p>

    <p class="note" style="font-size:90%; color:#444;">
        <sup id="note4">4</sup> この記事内にさくらインターネットの月額課金のオファーを取り上げましたが、さくらインターネットには<a href="https://www.sakura.ad.jp/koukaryoku/specification/" target="_blank">時間課金のオファー</a>や<a href="https://www.sakura.ad.jp/education/solution/cloud-teigaku.html?=mail_20170424" target="_blank">年間契約のオファー</a>もあります。
    </p>

</body>
</html>