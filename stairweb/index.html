<html>
<head>
    <style></style>
    <title>クラウドGPUの比較について</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <style type="text/css">
		body {
			font-family: "小塚明朝 Pr6N L",serif;
			letter-spacing:0.1em;
			line-height:170%;
		}
	</style>
</head>

<body>
    <p>
    ステアラボでは、私たちはクラウドでGPUが載っているマシンを使うことがあります。どのプロバイダーのどういうマシンを借りるか、選択は難しいです。複数のクラウドプロバイダーからの数多くのオファーの性能とコストを比較するため、私たちは各クラウドプロバイダーのウエブサイトから集めた情報を表にまとめ、いくつかインタラクティブグラフを作ってみました。<a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">こちら</a>は各オファーの主なスペックと料金の表の他に、CPUとGPUの性能を比較するグラフ、使う時間によって変動するコストのグラフ、一定の利用期間においてのコストのグラフ、CPUとGPUの1TFlopsあたりのコストを比較するグラフがあります。<a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">こちら</a>は計算量を固定した場合、GPUで計算する時間とそれにかかるコストのグラフとCPU計算時間とコストを比較する2つのグラフがあります。<br>
    また、両方のページの上部にオファーのグループを選択（フィルタリング）するための<a href="#pic1" title="Pic.1を参照">小さめのグラフ</a>もいくつかあります。そのグラフを見れば、プロバイダーごとのオファーの数、GPU数でオファーの分布、メモリー量でオファーの分布など、統計的な情報がわかります。</p>
    <p>
        機械学習などの計算をクラウドGPUでしようと思ったら、今はたくさんの選択肢があります。しかし、振り替えてみればわずか一年前は全く違う状況でした。まだ珍しかったクラウドGPUは主に可視化向けのものでした。2016年の9月から機械学習用のクラウドGPUのp2インスタンス<a href="#note1"><sup>1</sup></a>を提供し始めたAmazonに続いて、Softlayer (IBM)、 Nimbix、 MS Azure、 Google Compute Cloudなど、たくさんのプロバイダーから続々とたくさんのオファーが出ました。クラウドGPUオファーの主な用途が機械学習に変わったため、GPUとCPUの性能が上がり、メモリーも増えて：1000GBまでのインスタンスがあります。ストレージはSSDが主流になりました。
    </p>
        
    <p>
        マイクロソフトAzureクラウド初のGPUインスタンス、Nシリーズは去年の8月に発表されたものの、すべてのユーザに公開されたのは12月でした。AzureクラウドのNシリーズは他のプロバイダーのオファーの中で性能的にもコスト的にも目立ちませんが、マイクロソフトが開発した機械学習フレームワークAzure Machine Learning Studioを使用できるというメリットがあります。
        アメリカの大手クラウドプロバイダーの中で最も遅くGPUインスタンスの提供を始めたGoogleですが、インスタンスのスペックを細かく設定できるのは大きな特徴です。GPUの種類では、NVIDIA M60を載せたマイクロソフトのNVシリーズ以外は、アマゾン、マイクロソフト、グーグルはNVIDIA K80<a href="#note2"><sup>2</sup></a>を提供しています。
    </p>
     
    <p>
        同じ2016年にさくらインターネットという日本のプロバイダーがGPUサーバーの提供を始めました。他のプロバイダーの同レベルの性能のオファーと比べたら、月額はとても安いです。特にNVIDIA Titan Xを4枚載せたQuad GPU modelサーバーがコストパフォーマンスで魅力的です。ただ、初期費用があるため短期間で利用する場合は他社のオファーが有利になります。
    </p>
    <p>
        コストパフォマンスでさくらインターネットといい勝負をしているのはオランダのLeaderTelecomというプロバイダーです。GPUの性能がとても高く、NVIDIA GeForce GTX 1080を8枚載せたインスタンスも提供しています。CPUの性能も高いが、メモリー量は128GBまでという低めのスペックです。ちなみに、そのLeaderTelecomは以前はオファーの数でトップでしたが、最近はウェブサイトでオファーの数が減り、今は3種類のインスタンスだけを提供しているようです。未だにGPU性能で高水準のLeaderTelecomより、さらに高性能のインスタンスを提供するプロバイダーがあります。IBMのクラウドプロバイダーSoftlayerは、NVIDIA P40が8枚を載せたインスタンスとQuadro P6000が8枚の、GPU性能で最も高いインスタンスを提供しています。
    </p>
    <p>
        一般的なクラウドプロバイダーではないのですが、東京大学はGPUが載っているスパーコンピュータReedbush-Hを、教育機関はもちろんのこと、一般企業にも審査が通った用途に提供しています。GPUの性能では目立たないスペックなのですが、CPU性能やインターコネクト帯域幅などが最高標準です。値段も割安なので、審査さえクリアできれば、最高のコストパフォマンスのクラウドGPUを利用できます。ただ、一つ注意すべきところがあり、スーパーコンピューターは全てのノードのソフトウェア環境が同じであり、root権限も与えられないので、新しいソフトウェアをインストールできない可能性が高いです。もう一つの注意点としては、1年間のプランなのですが、使用できるノード時間が限られています。複数のノードにまたがるジョブを長時間で走らせていれば1年間足らずでノード時間がなくなってしまい、計算するには追加料金がかかってしまうことがあります。<a href="http://www.cc.u-tokyo.ac.jp/support/application/kitei/hyou5.pdf" target="_blank">東京大学のウエブサイト</a>の備考をよく読んでください。
    </p>

    
    <p>
        では、私たちが作ったグラフを使っていくつかのオファーを比較してみましょう。
        それぞれのオファーを比較する時はたくさんの要素を考慮する必要があります：GPUとCPUのモデル、メモリーとハードディスクの量、インターコネクトとインターネットの帯域幅など。料金も変わりますし、課金の時間単位も違います：分ごとに課金されるプランもあれば、年ごとに課金されるプランもあります。初期費用があるプランもあり、使用できるノード時間が制限されるプランもあります。
    </p>
     
    <p>
        インスタンスの性能を比較するために、先ずは性能に大きな影響を与えるGPU性能とCPU性能を比べてみましょう。<a href="http://comp.photo777.org/cloud-gpu-providers-comparison/" target="_blank">こちら</a>はGPUとCPU性能のグラフなど、参考にしたいグラフがあります。例えば、前に触れましたさくらとアマゾンのオファーを比較してみたい場合は、まずはページの上部にある小さめのフィルタリング用のグラフを使って、全てのグラフで表示されるオファーをプロバイダーで制限（フィルタリング）してましょう。
    </p>
    <figure id="pic1">
        <img src="filtergraphs.png" />
        <figcaption>Pic.1. プロバイダーでオファーを制限した状態のフィルタリンググラフ。一つのグラフをクリックして制限をかけると、他のグラフで制限されたオファーだけの情報が写ります。</figcaption>
    </figure>
    
   	<p>
    	アマゾンとさくらインターネットでオファーを制限したら、CPUとGPU性能グラフでオファーを比較しましょう。
    </p>
<figure>
        <img src="cpu_gpu_performance.png" />
        <figcaption>GPUとCPU性能グラフ。CPUとGPUの性能で近いAmazonとのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーを比較してみましょう。</figcaption>
    </figure>
    
    <p>
        アマゾンのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーはCPUとGPUの性能で近いのですが、どちらが安いでしょうか？さくらインターネットのオファーは月ごとに課金され、初期費用もかかります。一方、アマゾンのオファーは時間単位で課金され、初期費用もありません。下のコストグラフを見ますと、2ヶ月以上を使うならさくらインターネットのオファーの方が安くなることがわかります。
    </p>
    <figure>
        <img src="time_cost.png" />
        <figcaption>利用期間によって変動するコストのグラフ。Amazonのp2.8xlargeオファーとさくらインターネットのQuad GPU modelオファーのコストの比較。2ヶ月以上使うならさくらインターネットのオファーの方が安くなります。</figcaption>
    </figure>
    
    
    <p>
        上記のように性能で近いオファーの場合は、コストを比較さえすればどちらが有利かがわかります。性能的に遠いオファーの場合は性能単位であるFlopsあたりのコストで比較することができます。利用期間によってコストが変われば、Flopsあたりのコストも変動しますので、利用期間を変更すれば1TFlopsあたりのコストのグラフも変わります。
    </p>
    
        
    <figure>
    <img src="1tflops_cost.png" />
        <figcaption>1TFlopsあたりのコストでAmazonとさくらインターネットのオファーの比較。</figcaption>
    </figure>
    <p>
        アマゾンとさくらインターネットのオファーを比較してみると、2ヶ月の利用期間でGPUの1TFlopsあたりのコストでさくらTitanX x4インスタンスが一番安く、CPUの1TFlopsあたりのコストでアマゾンの1年間契約のp2インスタンスが一番安いことがわかります。利用期間を長くしたら、TitanX x4の方がCPU性能のコストでも一番安くなってきますし、GPUの性能ではアマゾンのオファーよりは数倍やすくなります。
    </p>    
    
    <p>
        利用したい期間は決まっていれば1TFlopsあたりのコストで比較せればいいのですが、もし利用したい期間ではなく、計算したいタスクが決まっている場合はどうすればいいでしょうか。計算が早く終われば、長くクラウドインスタンスを使う必要はありません。計算量が決まっていれば、計算にかかる時間とコストでオファーを比較することができます。性能の高いインスタンスほど計算時間が短くなり、その分コストも安くなりますので、多少コストが高くても性能の高いインスタンスが有利なはずです。<a href="http://comp.photo777.org/cloud-gpu-providers-more-graphs/" target="_blank">こちら</a>にあるがラフを使っておなじみのアマゾンとさくらインターネットのオファーを比較して見ましょう。
    </p>
    
    <figure>
    <img src="GPU_cost_time.png" />
        <figcaption>特定の計算量にかかる費用と時間のグラフ。左下に行くほど有利になります。</figcaption>
    </figure>
    
    
    <p>計算量を変えたりして計算にかかるコストと時間でオファーを比較しましょう。計算量が200EFlopsまで上がるあたりでさくらインターネットとAmazonのオファーが接戦しています。計算量がさらに増えれば増えるほどさくらインターネットのオファーが有利になります。CPUの場合は早くも50EFlopsあたりでさくらはアマゾンを追い越します。 計算量の大きいタスクほど、さくらインターネットが有利なることがわかります。</p>
    <p>最後に注意しておきたいのですが、CPUとGPU性能以外にも計算時間を左右する要素がたくさんあるので、今まで比較に使っていたFlopsは一つの目安にすぎないことを忘れずに上記のグラフを使ってください。 </p>
    <p>&nbsp;</p>
    
    
    
    <hr>
    <note>
        <sup id="note1">1</sup> クラウドコンピューティングでは貸出する仮想マシンのことをインスタンスといいます。このポストでは仮想マシンとベアメタルサーバを比較することがり、その時は、正しくないのですが、ベアメタルサーバのこともインスタンスと呼んだりしています。
    </note>
<br>
    <note>
        <sup id="note2">2</sup> Amazon、MicrosoftとGoogleがNVIDIA K80のインスタンスを提供していますが、プロバイダーのウエブサイトなどで表示されているGPUの数に注意する必要があります。1枚のK80のカードには2個のTesla GK210 GPUが載っており、プロバイダーが表示している数はGK210の数で、カードの枚数はその半分です。
    </note>


</body>
</html>