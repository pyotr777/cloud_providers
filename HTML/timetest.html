<head>
  <script src="https://cdn.plot.ly/plotly-1.8.0.min.js"></script>
</head>
<body>
  <div id="graph"></div>
  <div id="slice"></div>

  <script type="text/javascript">
    var selectorOptions = {
        buttons: [{
            step: 'month',
            stepmode: 'backward',
            count: 1,
            label: 'month'
        }, {
            step: 'day',
            stepmode: 'backward',
            count: 7,
            label: 'week'
        }, {
            step: 'day',
            stepmode: 'backward',
            count: 1,
            label: 'day'
        },{
            step: 'hour',
            stepmode: 'backward',
            count: 6,
            label: '6 hours'
        }, {
            step: 'all',
        }],
    };

    start = new Date(0);
    length = 500; // hours
    step = 6; // hours
    end = new Date(start.getTime() + length * 1000 * 3600);
    var data1 = prepDates(start,end,step, "line 1");
    var data2 = prepDates(start,end,step/2, "line 2>>>>>>>>csd2 -3434 -34343ddf");
    var layout = {
        title: 'Time series with range slider and selectors',
        hovermode:'closest',
        xaxis: {
            hoverformat: '%m/%d %H',
            rangeselector: selectorOptions,
            rangeslider: {}
        },
        yaxis: {

        }
    };
    var simple_layout = {
        title: " Simple",
        xaxis: {
            type: "date",
            hoverformat: "doesn't: {!s}",
            range: [0,35 * 1000 * 3600 * 24]
        },
        yaxis: {
            range: [-100, 100]
        }
    }
    traces = []
    traces.push(data1)
    traces.push(data2)

    Plotly.newPlot('graph', traces, layout);

    // Step in hours
    function prepDates(start,end,step, name) {
        var x = [];
        var y = [];
        var text=[];
        start_date = start;
        for (i = start.getTime(); i < end.getTime(); i = i + step*1000*3600) {
            x_ = new Date(i);
            y_ = Math.random() * 100
            x.push(x_);
            y.push(y_);
            timediff = x_.getTime() - start.getTime()
            disp_time = secondsToString(timediff/1000)
            text.push(disp_time);
            //console.log(x_ + "\t" + y_)
        }
        return {
            mode: 'lines',
            type: 'scatter',
            linewidth: 1,
            name: name,
            hoverinfo: "name+text",
            x: x,
            y: y,
            text: text
        };
    }

    function secondsToString(seconds) {
        var numyears = Math.floor(seconds / 31536000);
        var numdays = Math.floor((seconds % 31536000) / 86400);
        var numhours = Math.floor(((seconds % 31536000) % 86400) / 3600);
        var numminutes = Math.floor((((seconds % 31536000) % 86400) % 3600) / 60);
        var numseconds = (((seconds % 31536000) % 86400) % 3600) % 60;
        return numyears + " years " +  numdays + " days " + numhours + " hours " + numminutes + " minutes " + numseconds + " seconds";
    }

    var myPlot = document.getElementById('graph');

    myPlot.on('plotly_click', function(data) {
        console.log(data);
        var pts = '';
        for(var i=0; i < data.points.length; i++) {
            console.log(data.points[i].x);
            displaySlice(data.points[i].pointNumber);
            pts = '['+data.points[i].pointNumber +'] x = '+data.points[i].x +'\ny = '+
                data.points[i].y.toPrecision(4) + '\n\n';
        }
        console.log(data);
        alert('Closest point clicked:\n\n'+pts);
    });

    function displaySlice(n) {
        console.log("Clicked "+n);
        n2 = data2.x.indexOf(data1.x[n])
        console.log("Looking for "+ data1.x[n] + " in " + data2.x[0])
        console.log("index2 "+n2)
        console.log(data1.x[n] + " / " + data1.name+": "+data1.y[n] + "  " + data2.name+": "+data2.y[n]);
        var layout = {};
        var trace1 = {
            x : [data1.name, data2.name],
            y : [data1.y[n], data2.y[n]],
            name: data1.x[n],
            type: 'bar'
        };
        Plotly.newPlot('slice', [trace1], layout);
    }

  </script>
</body>